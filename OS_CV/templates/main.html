<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <title>OS-cv</title>
    <style>
      body {
        margin: 0;
        background: linear-gradient(135deg, #d7e1ec, #f3f3f3);
        font-family: sans-serif;
        overflow: hidden;
      }

      .inverted {
        clip-path: url(#clip);
        width: 100%;
        height: 100px;
        background-color: #b1b1b1;
        aspect-ratio: 4 / 1;
      }

      .row > * {
        flex-shrink: 0;
        width: 100%;
        max-width: 80%;
        padding-right: calc(var(--bs-gutter-x) * 0.5);
        padding-left: calc(var(--bs-gutter-x) * 0.5);
        margin-top: var(--bs-gutter-y);
      }

      .skill-box {
        clip-path: url(#clip-skill);
        width: 80px;
        height: 75px;
        background-color: var(--color);
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 15px;
        transition: transform 0.3s ease, filter 0.3s ease;
      }

      .skill-box img {
        width: 60%;
      }

      .skill-box:hover {
        transform: scale(1.1);
        filter: brightness(1.2);
        cursor: pointer;
      }

      .fixed-top-right {
        background: rgba(
          60,
          60,
          60,
          0.8
        ); /* Ø®Ø§Ú©Ø³ØªØ±ÛŒ ØªÛŒØ±Ù‡ Ø´ÙØ§Ùâ€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø­Ø³ Ù…Ø¯Ø±Ù† */
        color: white; /* Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯ Ø¨Ù‡ØªØ± Ù…ØªÙ† Ø±ÙˆÛŒ Ø²Ù…ÛŒÙ†Ù‡ */
        width: fit-content; /* Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙÙ‚Ø· Ø¨Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù…Ø­ØªÙˆØ§ */
        padding: 8px 15px; /* ÙØ§ØµÙ„Ù‡ Ø¯Ø§Ø®Ù„ÛŒ Ù…Ù†Ø§Ø³Ø¨ */
        display: flex;
        align-items: center;
        gap: 20px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø³Ø§Ø¹ØªØŒ ØªØ§Ø±ÛŒØ®ØŒ Ø¨Ø§ØªØ±ÛŒ */
        border-radius: 12px;
        position: fixed;
        right: 15px;
        top: 10px;
        font-family: "Segoe UI", sans-serif;
        font-size: 14px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(6px); /* Ø§ÙÚ©Øª Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ Ø¬Ø°Ø§Ø¨ */
        z-index: 1000;
      }

      #battery-container {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 5px;
      }

      #battery-outline {
        width: 40px;
        height: 20px;
        border: 2px solid #ddd;
        border-radius: 4px;
        position: relative;
        overflow: hidden;
      }

      #battery-cap {
        width: 4px;
        height: 10px;
        background: #ddd;
        border-radius: 2px;
        margin-left: -6px;
      }

      #battery-level {
        height: 100%;
        width: 50%;
        background: #4caf50;
        transition: width 0.5s ease, background 0.5s ease;
      }

      #battery-percentage {
        font-size: 0.9rem;
      }

      .app-window {
        position: absolute;
        top: 100px;
        left: 100px;
        width: 400px;
        background: #f3f3f3;
        border: 2px solid #444;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        z-index: 100;
        display: none;
      }

      .app-header {
        background: #555;
        color: white;
        padding: 8px;
        border-radius: 6px 6px 0 0;
        cursor: move;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .app-content {
        padding: 10px;
        color: #222;
      }

      .app-window {
        resize: both;
        overflow: auto;
      }

      #desktop-icons {
        display: flex;
        gap: 40px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .app-icon {
        text-align: center;
        width: 80px;
        cursor: pointer;
      }

      .app-icon img {
        width: 64px;
        height: 64px;
        transition: 0.2s;
      }

      .app-icon:hover img {
        transform: scale(1.1);
      }

      .app-icon p {
        color: #333;
        font-size: 13px;
        margin-top: 4px;
      }

      /* Ù†Ø§Ø­ÛŒÙ‡ Ú©Ù„ÛŒ Ø¯Ø³Ú©ØªØ§Ù¾ */
      #desktop-area {
        position: relative;
        width: 100vw;
        height: 100vh;
        background: linear-gradient(180deg, #e8eaed, #cfd2d6);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      /* Ø¨Ø®Ø´ Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ Ø¯Ø± ÙˆØ³Ø· ØµÙØ­Ù‡ */
      #desktop-icons {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start; /* Ø´Ø±ÙˆØ¹ Ø§Ø² Ø³Ù…Øª Ú†Ù¾ */
        align-items: center;
        gap: 25px;
        width: 70%;
        max-width: 800px;
        padding: 20px;
      }

      /* Ø¢ÛŒÚ©ÙˆÙ† Ù‡Ø± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† */
      .app-icon {
        width: 90px;
        height: 90px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        backdrop-filter: blur(6px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        text-align: center;
        user-select: none;
      }

      .app-icon img {
        width: 50px;
        height: 50px;
        object-fit: contain;
        margin-bottom: 8px;
      }

      .app-icon p {
        font-size: 14px;
        color: #2e2e2e;
        margin: 0;
        font-weight: 500;
      }

      /* Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù‚Ø¨Ù„ÛŒ Ú©Ù†ÛŒØ¯ */
      .app-window {
        transition: transform 300ms ease, opacity 250ms ease;
        transform-origin: center bottom;
        /* Ù…Ø·Ù…Ø¦Ù† Ø´ÛŒØ¯ Ø¯Ø± Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ Ù‚Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© Ø¨Ø§Ø´Ù‡ */
        pointer-events: auto;
      }

      /* Ú©Ù„Ø§Ø³ ÙˆÙ‚ØªÛŒ Ø¯Ø± Ø­Ø§Ù„ Ù…ÛŒÙ†ÛŒÙ…Ø§ÛŒØ² Ø´Ø¯Ù† Ù‡Ø³Øª (Ø§Ù†ÛŒÙ…ÛŒØ´Ù†) */
      .app-window.minimized {
        transform: scale(0.12) translateY(220px);
        opacity: 0;
        pointer-events: none;
      }

      /* Ú©Ù„Ø§Ø³ ÙˆÙ‚ØªÛŒ Ù¾Ø³ Ø§Ø² Ù…ÛŒÙ†ÛŒÙ…Ø§ÛŒØ² Ú©Ø§Ù…Ù„ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒÙ… Ú©Ø§Ù…Ù„Ø§Ù‹ Ù…Ø®ÙÛŒ Ø¨Ø§Ø´Ù‡ */
      .app-window.hidden {
        display: none !important;
      }

      .app-header {
        background: linear-gradient(180deg, #585858, #404040);
        color: white;
        padding: 6px 10px;
        cursor: move;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-radius: 8px 8px 0 0;
      }

      .window-controls button {
        background: none;
        border: none;
        color: white;
        font-weight: bold;
        margin-left: 8px;
        cursor: pointer;
        transition: 0.2s;
      }
      .window-controls button:hover {
        color: #ff6961;
      }

      .app-body {
        background: white;
        height: calc(100% - 35px);
        overflow: auto;
        padding: 10px;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .taskbar {
        position: fixed;
        bottom: 99px; /* Ú©Ù…ÛŒ Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ */
        left: 50%;
        transform: translateX(-50%);
        background: rgba(40, 40, 40, 0.8);
        color: white;
        border-top-left-radius: 25px;
        border-top-right-radius: 25px;
        padding: 6px 12px;
        display: flex;
        gap: 10px;
        align-items: center;
        min-width: 200px;
        max-width: 60%;
        justify-content: center;
        backdrop-filter: blur(6px);
        z-index: 1000;
      }

      .taskbar-item {
        display: flex;
        align-items: center;
        gap: 6px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        padding: 4px 10px;
        cursor: pointer;
        transition: 0.2s;
      }

      .taskbar-item:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .taskbar-item img {
        width: 20px;
        height: 20px;
      }

      .window-buttons {
        display: flex;
        gap: 6px;
      }

      .window-buttons button {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        border-radius: 4px;
        width: 25px;
        height: 25px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.2s;
      }

      .window-buttons button:hover {
        background: rgba(255, 255, 255, 0.4);
      }

      /* ğŸ”¹ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¨Ø§Ø² Ø´Ø¯Ù† */
      @keyframes appOpen {
        0% {
          opacity: 0;
          transform: scale(0.85) translateY(20px);
        }
        100% {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      /* ğŸ”¹ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† */
      @keyframes appClose {
        0% {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
        100% {
          opacity: 0;
          transform: scale(0.85) translateY(20px);
        }
      }

      /* ğŸ”¹ Ø­Ø§Ù„Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†ÛŒ */
      .app-window {
        animation: appOpen 0.3s ease forwards;
        transition: opacity 0.3s, transform 0.3s;
      }

      .app-window.closing {
        animation: appClose 0.3s ease forwards;
      }

      .app-header {
        background: linear-gradient(180deg, #585858, #404040);
        color: white;
        padding: 6px 10px;
        cursor: move;
        display: flex;
        align-items: center; /* Ø¹Ù…ÙˆØ¯Ø§Ù‹ ÙˆØ³Ø· */
        justify-content: space-between; /* Ù…ØªÙ† Ø³Ù…Øª Ú†Ù¾ØŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø³Ù…Øª Ø±Ø§Ø³Øª */
        border-radius: 8px 8px 0 0;
        height: 35px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ */
        box-sizing: border-box;
      }

      .window-buttons {
        display: flex;
        align-items: center; /* ÙˆØ³Ø·â€ŒÚ†ÛŒÙ† Ø¹Ù…ÙˆØ¯ÛŒ */
        gap: 6px;
        height: 100%;
      }

      .window-buttons button {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        border-radius: 4px;
        width: 24px;
        height: 24px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        padding: 0;
        transition: background 0.2s;
      }

      .window-buttons button:hover {
        background: rgba(255, 255, 255, 0.4);
      }

      /* ğŸ”¹ Ù…Ù†ÙˆÛŒ Ø±Ø§Ø³Øªâ€ŒÚ©Ù„ÛŒÚ© */
      .context-menu {
        position: absolute;
        display: none;
        background: #222;
        color: white;
        border-radius: 8px;
        list-style: none;
        padding: 8px 0;
        min-width: 180px;
        font-size: 14px;
        z-index: 2000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      }

      .context-menu li {
        padding: 6px 14px;
        cursor: pointer;
        white-space: nowrap;
      }

      .context-menu li:hover {
        background: #444;
      }

      .context-menu .has-submenu {
        position: relative;
      }

      .submenu {
        position: absolute;
        top: 0;
        left: 100%;
        display: none;
        background: #333;
        border-radius: 8px;
        padding: 6px 0;
        list-style: none;
        min-width: 160px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .has-submenu:hover .submenu {
        display: block;
      }

      .modal-wallpaper {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        justify-content: center;
        align-items: center;
        z-index: 3000;
      }

      .modal-content{
        background: #2e2e2e;
        color: white;
        padding: 20px;
        border-radius: 12px;
        width: 360px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        display: flex;
        flex-direction: column;
        align-items: center;
        animation: fadeIn 0.3s ease;
      }

      .modal-content h4{
        margin-bottom: 10px;
        font-weight: 500;
        color: #ddd;
      }

      #wallpaper-url-input{
        width: 100%;
        padding: 8px 10px;
        border: none;
        border-radius: 8px;
        margin-bottom: 12px;
        font-size: 14px;
        color: #fff;
      }

      #wallpaper-url-input:focus{
        color: #555;
      }

      #wallpaper-preview{
        width: 100%;
        max-height: 150px;
        border-radius: 8px;
        margin-bottom: 15px;
        object-fit: cover;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        border: 1px solid #555;
      }

      .modal-buttons button{
        background: #0d6efd;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        transition: background 0.2s;
      }

      .modal-buttons button:hover{
        background: #0b5ed7;
      }

      .modal-buttons #cancel-wallpaper-btn{
        background: #777;
      }

      .modal-buttons #cancel-wallpaper-btn:hover{
        background: #666;
      }
    </style>
  </head>
  <body>
    <!-- top part -->
    <div class="fixed-top-right">
      <div id="date-display"></div>
      <div id="time-display"></div>
      <div id="battery-container">
        <div id="battery-outline">
          <div id="battery-level"></div>
        </div>
        <div id="battery-cap"></div>
        <span id="battery-percentage"></span>
      </div>
    </div>

    <!-- Main part -->
    <div id="desktop-area">
      <div id="desktop-icons">
        {% for app in webApps %}
        <div
          class="app-icon"
          data-app="{{ app.name|slugify }}"
          data-name="{{ app.name }}"
          data-html="{{ app.html_content|escapejs }}"
          data-css="{{ app.css_content|escapejs }}"
          data-js="{{ app.js_content|escapejs }}"
          onclick="openApp(this)"
        >
          <img src="{{ app.get_icon_url }}" alt="{{ app.name }}" />
          <p>{{ app.name }}</p>
        </div>
        {% endfor %}
      </div>

      <div id="window-container"></div>
    </div>
    <!-- bottom part -->
    <div class="row fixed-bottom justify-content-center">
      <div id="taskbar" class="taskbar"></div>
      <svg
        xmlns="http://www.w3.org/2000/svg"
        style="display: block; position: absolute"
        width="0"
        height="0"
      >
        <defs>
          <clipPath id="clip" clipPathUnits="objectBoundingBox">
            <path
              d="M0.065,0H0.935A0.065,0.26,0,0,1,1,0.26V0.74A0.065,0.26,0,0,1,0.935,1H0.065A0.065,0.26,0,0,1,0,0.74V0.26A0.065,0.26,0,0,1,0.065,0Z"
            />
          </clipPath>
        </defs>
      </svg>
      <div
        class="inverted d-flex flex-wrap justify-content-center align-items-center"
        style="border-radius: 60px"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          style="display: block; position: absolute"
          width="0"
          height="0"
        >
          <defs>
            <clipPath id="clip" clipPathUnits="objectBoundingBox">
              <path
                d="M0.195,0H0.805A0.195,0.195,0,0,1,1,0.195V0.805A0.195,0.195,0,0,1,0.805,1H0.195A0.195,0.195,0,0,1,0,0.805V0.195A0.195,0.195,0,0,1,0.195,0Z"
              />
            </clipPath>
          </defs>
        </svg>
        {% for skills in Skill %}
        <div
          class="skill-box"
          style="--color: {{ skills.color }}; clip-path: url(#clip);width: 80px;height: 75px;aspect-ratio: 1 / 1;border-radius: 20px;"
          data-bs-toggle="tooltip"
          title="{{ skills.title }}"
        >
          <img src="{{ skills.get_icon_url }}" alt="{{ skills.title }}" />
        </div>
        {% empty %}
        <p>there is no skills</p>
        {% endfor %}
      </div>
    </div>
    <!-- ğŸ“œ Ù…Ù†ÙˆÛŒ Ø±Ø§Ø³Øªâ€ŒÚ©Ù„ÛŒÚ© Ø¯Ø³Ú©ØªØ§Ù¾ -->
    <ul id="context-menu" class="context-menu">
      <li onclick="newApp()">ğŸŸ¢ New App</li>
      <li onclick="refreshDesktop()">ğŸ”„ Refresh</li>

      <li class="has-submenu">
        ğŸ–¼ï¸ Change Wallpaper â–¸
        <ul class="submenu">
          <li onclick="openFilePicker()">ğŸ“ Upload Image</li>
          <li onclick="openURLPopup()">ğŸŒ Enter URL</li>
          <li onclick="resetWallpaper()">â™»ï¸ Reset to Default</li>
        </ul>
      </li>

      <li onclick="openSettings()">âš™ï¸ Desktop Settings</li>
    </ul>

    <!-- ÙˆØ±ÙˆØ¯ÛŒ ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ú©Ø³ -->
    <input
      type="file"
      id="wallpaperFile"
      accept="image/*"
      style="display: none"
    />

    <!-- Ù¾Ù†Ø¬Ø±Ù‡ Ù¾Ø§Ù¾â€ŒØ¢Ù¾ ØªÙ†Ø¸ÛŒÙ… ÙˆØ§Ù„Ù¾ÛŒÙ¾Ø± -->
    <div
      id="wallpaperPopup"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        z-index: 2000;
        width: 300px;
        text-align: center;
      "
    >
      <h4 style="margin-bottom: 10px">Change Wallpaper</h4>
      <button
        onclick="chooseWallpaperFile()"
        style="margin-bottom: 10px"
        class="btn btn-primary btn-sm"
      >
        Upload Image
      </button>
      <div style="margin: 8px 0">or</div>
      <input
        type="text"
        id="wallpaperURL"
        placeholder="Enter image URL..."
        style="
          width: 100%;
          padding: 6px;
          border: 1px solid #ccc;
          border-radius: 6px;
        "
      />
      <div
        style="margin-top: 12px; display: flex; justify-content: space-between"
      >
        <button class="btn btn-success btn-sm" onclick="applyWallpaper()">
          Apply
        </button>
        <button
          class="btn btn-secondary btn-sm"
          onclick="closeWallpaperPopup()"
        >
          Cancel
        </button>
      </div>
    </div>

    <!-- wallpaper url modal -->
     <div id="wallpaper-url-modal" class="modal-wallpaper" >
      <div class="modal-content">
        <h4>enter wallpaper url</h4>
        <input type="text" id="wallpaper-url-input" placeholder="Enter image URL..." />
        <img src="wallpaper-preview" alt="preview" style="display: none;">
        <div class="modal-buttons">
          <button id="apply-wallpaper-btn" >Apply</button>
          <button id="cancel-wallpaper-btn" >Cancel</button>
        </div>
      </div>
     </div>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"
  ></script>
  <script>
    function updateClock() {
      const now = new Date();
      const time = now.toLocaleTimeString([], {
        hour: "2-digit",
        minute: "2-digit",
      });
      const date = now.toLocaleDateString(undefined, {
        weekday: "short",
        month: "short",
        day: "numeric",
      });
      document.getElementById("time-display").textContent = time;
      document.getElementById("date-display").textContent = date;
    }

    setInterval(updateClock, 1000);
    updateClock();

    if ("getBattery" in navigator) {
      navigator.getBattery().then(function (battery) {
        function updateBattery() {
          const level = Math.round(battery.level * 100);
          document.getElementById(
            "battery-display"
          ).textContent = `ğŸ”‹${level}%`;
        }
        updateBattery();
        battery.addEventListener("levelchange", updateBattery);
      });
    } else {
      document.getElementById("battery-display").textContent = "ğŸ”‹N/A";
    }

    async function updateBattery() {
      if ("getBattery" in navigator) {
        const battery = await navigator.getBattery();
        const levelBar = document.getElementById("battery-level");
        const percentageText = document.getElementById("battery-percentage");

        function updateAll() {
          const level = Math.round(battery.level * 100);
          percentageText.textContent = level + "%";
          levelBar.style.width = level + "%";

          if (battery.charging) {
            levelBar.style.background = "#00bcd4"; // Ø¢Ø¨ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ø´Ø§Ø±Ú˜
          } else if (level > 80) {
            levelBar.style.background = "#4caf50"; // Ø³Ø¨Ø²
          } else if (level > 40) {
            levelBar.style.background = "#ffeb3b"; // Ø²Ø±Ø¯
          } else if (level > 15) {
            levelBar.style.background = "#ff9800"; // Ù†Ø§Ø±Ù†Ø¬ÛŒ
          } else {
            levelBar.style.background = "#f44336"; // Ù‚Ø±Ù…Ø²
          }
        }

        updateAll();
        battery.addEventListener("levelchange", updateAll);
        battery.addEventListener("chargingchange", updateAll);
      } else {
        document.getElementById("battery-container").innerHTML =
          "Battery info not supported";
      }
    }

    updateBattery();

    let highestZ = 10;

    function setupWindow(win) {
      const header = win.querySelector(".app-header");
      const minimize = win.querySelector(".minimize-btn");
      const maximize = win.querySelector(".maximize-btn");
      const close = win.querySelector(".close-btn");
      const body = win.querySelector(".app-body");

      // bring to front
      win.addEventListener("mousedown", () => {
        win.style.zIndex = ++highestZ;
      });

      // dragging
      let offsetX = 0,
        offsetY = 0,
        dragging = false;

      header.addEventListener("mousedown", (e) => {
        dragging = true;
        offsetX = e.clientX - win.offsetLeft;
        offsetY = e.clientY - win.offsetTop;
        win.style.zIndex = ++highestZ;
      });

      document.addEventListener("mousemove", (e) => {
        if (!dragging) return;
        win.style.left = `${e.clientX - offsetX}px`;
        win.style.top = `${e.clientY - offsetY}px`;
      });

      document.addEventListener("mouseup", () => (dragging = false));

      // close button
      close.addEventListener("click", () => win.remove());

      // minimize
      minimize.addEventListener("click", () => {
        body.style.display = body.style.display === "none" ? "block" : "none";
      });

      // maximize
      maximize.addEventListener("click", () => {
        if (win.classList.contains("maximized")) {
          win.style.top = win.dataset.prevTop;
          win.style.left = win.dataset.prevLeft;
          win.style.width = win.dataset.prevWidth;
          win.style.height = win.dataset.prevHeight;
          win.classList.remove("maximized");
        } else {
          win.dataset.prevTop = win.style.top;
          win.dataset.prevLeft = win.style.left;
          win.dataset.prevWidth = win.style.width;
          win.dataset.prevHeight = win.style.height;
          win.style.top = "0";
          win.style.left = "0";
          win.style.width = "100vw";
          win.style.height = "100vh";
          win.classList.add("maximized");
        }
      });
    }

    // ÛŒÚ© Ù…ØªØºÛŒØ± Ø¨Ø±Ø§ÛŒ Ø§ÙØ²Ø§ÛŒØ´ z-index Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù¾Ù†Ø¬Ø±Ù‡ Ø¨Ø§Ø²Ø´Ø¯Ù‡ Ø¬Ù„Ùˆ Ø¨Ø§Ø´Ù‡
    let topZ = 1000;
    function bringToFront(el) {
      topZ++;
      el.style.zIndex = topZ;
    }

    window.openApp = window.openApp || function () {};

    window.openApp = function (el) {
      const slug = el.dataset.app;
      const name = el.dataset.name;
      const htmlContent = JSON.parse('"' + el.dataset.html + '"');
      const cssContent = JSON.parse('"' + el.dataset.css + '"');
      const jsContent = JSON.parse('"' + el.dataset.js + '"');

      let existing = document.getElementById(`window-${slug}`);
      if (existing) {
        existing.style.display = "block";
        existing.classList.remove("minimized");
        return;
      }

      // Ø³Ø§Ø®Øª Ù¾Ù†Ø¬Ø±Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡
      const windowDiv = document.createElement("div");
      windowDiv.className = "app-window";
      windowDiv.id = `window-${slug}`;
      windowDiv.innerHTML = `
    <div class="app-header">
      <span>${name}</span>
      <div class="window-buttons">
        <button onclick="minimizeApp('${slug}')">â€”</button>
        <button onclick="closeApp('${slug}')">Ã—</button>
      </div>
    </div>
    <div class="app-body">${htmlContent}</div>
  `;
      document.getElementById("window-container").appendChild(windowDiv);

      windowDiv.style.animation = "appOpen 0.3s ease";

      // Ø³Ø§Ø®Øª Ø¢ÛŒÚ©ÙˆÙ† Ø¯Ø± ØªØ³Ú©â€ŒØ¨Ø§Ø±
      const taskbar = document.getElementById("taskbar");
      if (!document.getElementById(`task-${slug}`)) {
        const taskIcon = document.createElement("div");
        taskIcon.className = "task-icon";
        taskIcon.id = `task-${slug}`;
        taskIcon.innerHTML = `<img src="${
          el.querySelector("img").src
        }" alt="${name}" style="width:28px;height:28px;">`;
        taskIcon.onclick = () => toggleApp(slug);
        taskbar.appendChild(taskIcon);
      }

      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† CSS Ùˆ JS Ø§Ø®ØªØµØ§ØµÛŒ
      if (cssContent.trim()) {
        const styleTag = document.createElement("style");
        styleTag.textContent = cssContent;
        windowDiv.appendChild(styleTag);
      }

      if (jsContent.trim()) {
        const scriptTag = document.createElement("script");
        scriptTag.textContent = jsContent;
        windowDiv.appendChild(scriptTag);
      }

      makeDraggable(windowDiv);
      setupWindow(windowDiv);
      bringToFront(windowDiv);
    };

    function makeDraggable(el) {
      const header = el.querySelector(".app-header");
      if (!header) return;

      let offsetX = 0,
        offsetY = 0,
        isDragging = false;

      header.addEventListener("mousedown", (e) => {
        isDragging = true;
        offsetX = e.clientX - el.offsetLeft;
        offsetY = e.clientY - el.offsetTop;
      });

      document.addEventListener("mousemove", (e) => {
        if (!isDragging) return;
        el.style.left = e.clientX - offsetX + "px";
        el.style.top = e.clientY - offsetY + "px";
      });

      document.addEventListener("mouseup", () => (isDragging = false));
    }

    window.minimizeApp = function (slug) {
      const app = document.getElementById(`window-${slug}`);
      if (app) {
        app.classList.add("closing");
        setTimeout(() => {
          app.style.display = "none";
          app.classList.remove("closing");
        }, 300); // Ø²Ù…Ø§Ù† Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ø¨Ø§ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
      }
    };

    window.closeApp = function (slug) {
      const app = document.getElementById(`window-${slug}`);
      const task = document.getElementById(`task-${slug}`);
      if (app) {
        app.classList.add("closing");
        setTimeout(() => {
          app.remove();
          if (task) task.remove();
        }, 400); // Ú©Ù…ÛŒ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ø²Ù…Ø§Ù† Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
      }
    };

    window.toggleApp = function (slug) {
      const app = document.getElementById(`window-${slug}`);
      if (!app) return;

      if (app.classList.contains("hidden")) {
        app.classList.remove("hidden");
        app.style.display = "block";
        setTimeout(() => app.classList.remove("minimized"), 10);
      } else {
        app.classList.add("minimized");
        setTimeout(() => app.classList.add("hidden"), 300);
      }
    };

    // ğŸ¯ Ù‡Ø¯Ù Ù…Ù†Ùˆ Ùˆ Ø¯Ø³Ú©ØªØ§Ù¾
    const desktop = document.getElementById("desktop-area");
    const contextMenu = document.getElementById("context-menu");

    // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ù†Ùˆ Ø¯Ø± Ù…Ø­Ù„ Ú©Ù„ÛŒÚ©
    desktop.addEventListener("contextmenu", (e) => {
      e.preventDefault(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ù†ÙˆÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø±ÙˆØ±Ú¯Ø±

      // Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ø§ÙˆØ³
      contextMenu.style.top = `${e.clientY}px`;
      contextMenu.style.left = `${e.clientX}px`;
      contextMenu.style.display = "block";
    });

    // Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø¨ÛŒØ±ÙˆÙ†
    document.addEventListener("click", (e) => {
      if (!contextMenu.contains(e.target)) {
        contextMenu.style.display = "none";
      }
    });

    // ğŸ”„ ØªØ§Ø¨Ø¹ Ø±ÙØ±Ø´ Ø¯Ø³Ú©ØªØ§Ù¾
    function refreshDesktop() {
      // Ø¨Ø³ØªÙ† Ù…Ù†ÙˆÛŒ Ø±Ø§Ø³Øªâ€ŒÚ©Ù„ÛŒÚ© (Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø§Ø² Ø¨ÙˆØ¯Ù†)
      const contextMenu = document.getElementById("context-menu");
      if (contextMenu) contextMenu.style.display = "none";

      // Ù†Ù…Ø§ÛŒØ´ Ø§Ù†ÛŒÙ…ÛŒØ´Ù† ÛŒØ§ Ø§ÙÚ©Øª Ø¨Ø±Ø§ÛŒ Ø­Ø³ Ø±ÙØ±Ø´ ÙˆØ§Ù‚Ø¹ÛŒ
      const desktop = document.getElementById("desktop-area");
      desktop.style.opacity = "0.4";
      desktop.style.transition = "opacity 0.3s";

      setTimeout(() => {
        // Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ø¸Ø§Ù‡Ø± Ø¹Ø§Ø¯ÛŒ
        desktop.style.opacity = "1";

        // ğŸ” Ø±ÙØ±Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ (ÙØ¹Ù„Ø§Ù‹ Ø³Ø§Ø¯Ù‡: ÙÙ‚Ø· Ø±ÙØ±Ø´ Ú©Ø§Ù…Ù„ ØµÙØ­Ù‡)
        location.reload(); // Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ø¹Ø¯Ø§Ù‹ Ø§ÛŒÙ† Ø±Ùˆ Ù‡ÙˆØ´Ù…Ù†Ø¯Ø´ Ú©Ù†ÛŒ
      }, 300);
    }

    function changeWallpaper() {
      const input = document.getElementById("wallpaperInput");
      input.click();

      input.onchange = function (event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          const desktop = document.getElementById("desktop-area");
          desktop.style.background = `url(${e.target.result}) center/cover no-repeat`;
          localStorage.setItem("wallpaper", e.target.result); // Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± session
        };
        reader.readAsDataURL(file);
      };
    }

    // ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ø±ÙØ±Ø´ Ø´Ø¯ØŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù‚Ø¨Ù„ÛŒ Ø±Ùˆ Ø¨Ø±Ú¯Ø±Ø¯ÙˆÙ†:
    window.addEventListener("load", () => {
      const savedWallpaper = localStorage.getItem("wallpaper");
      if (savedWallpaper) {
        document.getElementById(
          "desktop-area"
        ).style.background = `url(${savedWallpaper}) center/cover no-repeat`;
      }
    });

    function changeWallpaper() {
      document.getElementById("wallpaperPopup").style.display = "block";
    }

    function closeWallpaperPopup() {
      document.getElementById("wallpaperPopup").style.display = "none";
      document.getElementById("wallpaperURL").value = "";
    }

    function chooseWallpaperFile() {
      document.getElementById("wallpaperFile").click();
    }

    // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø§Ø² ÙØ§ÛŒÙ„ Ø®ÙˆØ¯Ø´ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯
    document
      .getElementById("wallpaperFile")
      .addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function (event) {
          applyWallpaperBackground(event.target.result);
        };
        reader.readAsDataURL(file);
        closeWallpaperPopup();
      });

    function applyWallpaper() {
      const url = document.getElementById("wallpaperURL").value.trim();
      if (url) {
        applyWallpaperBackground(url);
        closeWallpaperPopup();
      }
    }

    function applyWallpaperBackground(imageSrc) {
      const desktop = document.getElementById("desktop-area");
      desktop.style.background = `url(${imageSrc}) center/cover no-repeat`;
      localStorage.setItem("wallpaper", imageSrc);
    }

    // Ù…ÙˆÙ‚Ø¹ Ù„ÙˆØ¯ ØµÙØ­Ù‡ØŒ ÙˆØ§Ù„Ù¾ÛŒÙ¾Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡ Ø±Ùˆ Ù„ÙˆØ¯ Ú©Ù†
    window.addEventListener("load", () => {
      const saved = localStorage.getItem("wallpaper");
      if (saved) {
        document.getElementById(
          "desktop-area"
        ).style.background = `url(${saved}) center/cover no-repeat`;
      }
    });

    // ğŸ“ Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„
    function openFilePicker() {
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "image/*";
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
          applyWallpaper(event.target.result);
        };
        reader.readAsDataURL(file);
      };
      input.click();
    }

    // ğŸŒ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù„ÛŒÙ†Ú© ØªØµÙˆÛŒØ±
    function openURLPopup() {
      const modal = document.getElementById("wallpaper-url-modal");
      const input = document.getElementById("wallpaper-url-input");
      const preview = document.getElementById("wallpaper-preview");
      const applyBtn = document.getElementById("apply-wallpaper-btn");
      const cancelBtn = document.getElementById("cancel-wallpaper-btn");

      modal.style.display = "flex";
      input.value = "";
      preview.style.display = "none";

      input.oninput = () => {
        const url = input.value.trim();
        if (url && (url.startsWith("http://") || url.startsWith("https://"))) {
          preview.src = url;
          preview.style.display = "block";
        } else {
          preview.style.display = "none";
        }
      };
    }

      applyBtn.onclick = () => {
        const url = input.value.trim();
        if (url && (url.startsWith("http://") || url.startsWith("https://"))) {
          applyWallpaper(url);
          modal.style.display = "none";
        } else {
          alert("Please enter a valid image URL.");
        };

        cancelBtn.onclick = () => {
          modal.style.display = "none";
      };

      modal.onclick = (e) => {
        if (e.target === modal) {
          modal.style.display = "none";
        }
      };
    }

    // â™»ï¸ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ø¨Ù‡ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    function resetWallpaper() {
      localStorage.removeItem("wallpaper");
      document.getElementById("desktop-area").style.background =
        "linear-gradient(180deg, #e8eaed, #cfd2d6)";
    }

    // ğŸ’¾ Ø§Ø¹Ù…Ø§Ù„ ØªØµÙˆÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ùˆ Ø°Ø®ÛŒØ±Ù‡
    function applyWallpaper(src) {
      const desktop = document.getElementById("desktop-area");
      desktop.style.background = `url(${src}) center/cover no-repeat`;
      localStorage.setItem("wallpaper", src);
    }

    // â™»ï¸ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡ Ù…ÙˆÙ‚Ø¹ Ù„ÙˆØ¯
    window.addEventListener("load", () => {
      const saved = localStorage.getItem("wallpaper");
      if (saved) {
        document.getElementById(
          "desktop-area"
        ).style.background = `url(${saved}) center/cover no-repeat`;
      }
    });
  </script>
</html>